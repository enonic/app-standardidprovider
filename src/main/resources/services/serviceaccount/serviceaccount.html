<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    <title class="localise">Service Account</title>
</head>
<body>
<div>
    <label id="crypto-generator" for="crypto-generator-button">Generate RSA keys for Service Account</label>
    <button id="crypto-generator-button">
        Generate Keys
    </button>
    <script type="application/javascript">
        function saveDataAsJsonFile(blob) {
            const downloadAnchor = document.createElement('a');
            downloadAnchor.href = URL.createObjectURL(blob);
            downloadAnchor.download = 'service-account-info.json';
            downloadAnchor.click();
            downloadAnchor.remove();
        }

        if (window.Worker) {
            const generateBtn = document.querySelector('#crypto-generator-button');

            const cryptoWorker = new Worker(new URL("{{assetUrlPrefix}}/worker.js"));

            cryptoWorker.onmessage = function (event) {
                // console.log(event);

                const contentAsBlob = new Blob([JSON.stringify({
                    privateKey: event.data.privateKey,
                    publicKey: event.data.publicKey,
                    kid: event.data.kid,
                    serviceAccountKey: 'user:system:test-sa'
                }, null, 2)], {
                    type: 'application/json'
                });

                saveDataAsJsonFile(contentAsBlob);
            };

            generateBtn.onclick = function (event) {
                event.preventDefault();
                cryptoWorker.postMessage({});
            };
        }
    </script>
</div>
</body>
</html>
